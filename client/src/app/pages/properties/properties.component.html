<mat-toolbar color="primary" class="toolbar">
  <span class="title">MyMahir - Available Properties</span>
  <span class="spacer"></span>
  <button mat-raised-button color="accent" (click)="navigateToLogin()">
    <mat-icon>login</mat-icon>
    Login / Register
  </button>
</mat-toolbar>

<div class="container">
  <div class="search-section">
    <h2>Find Your Next Home</h2>
    <form [formGroup]="searchForm" class="search-form">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search</mat-label>
        <input matInput formControlName="search" placeholder="Search by location, property name...">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="rent-field">
        <mat-label>Min Rent</mat-label>
        <input matInput type="number" formControlName="minRent" placeholder="0">
        <span matPrefix>$&nbsp;</span>
      </mat-form-field>

      <mat-form-field appearance="outline" class="rent-field">
        <mat-label>Max Rent</mat-label>
        <input matInput type="number" formControlName="maxRent" placeholder="10000">
        <span matPrefix>$&nbsp;</span>
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="onSearch()" type="button">
        Search
      </button>

      <button mat-button (click)="clearFilters()" type="button">
        Clear
      </button>
    </form>
  </div>

  <div *ngIf="isLoading()" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading properties...</p>
  </div>

  <div *ngIf="error()" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error() }}</p>
    <button mat-raised-button color="primary" (click)="loadProperties()">
      Try Again
    </button>
  </div>

  <div *ngIf="!isLoading() && !error()" class="properties-grid">
    <mat-card *ngFor="let property of properties()" class="property-card">
      <img mat-card-image [src]="getPropertyImage(property)" [alt]="property.title">

      <mat-card-header>
        <mat-card-title>{{ property.title }}</mat-card-title>
        <mat-card-subtitle>
          {{ property.address }}
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="description" *ngIf="property.description">
          {{ property.description.length > 120 ? property.description.substring(0, 120) + '...' : property.description }}
        </p>

        <div class="property-footer">
          <div class="rent-price">
            <span class="price">RM {{ property.monthlyRent | number:'1.0-0' }}</span>
            <span class="period">/month</span>
          </div>
          <mat-chip-set>
            <mat-chip [highlighted]="true" color="primary">{{ property.status }}</mat-chip>
          </mat-chip-set>
        </div>

        <div class="landlord-info">
          <mat-icon>person</mat-icon>
          <span>{{ property.landlord.name || property.landlord.email }}</span>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button color="primary" (click)="navigateToLogin()">
          <mat-icon>contact_mail</mat-icon>
          Contact Landlord
        </button>
      </mat-card-actions>
    </mat-card>

    <div *ngIf="properties().length === 0" class="no-properties">
      <mat-icon>home_work</mat-icon>
      <h3>No Properties Found</h3>
      <p>Try adjusting your search filters or check back later for new listings.</p>
    </div>
  </div>
</div>
